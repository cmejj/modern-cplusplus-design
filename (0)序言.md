# 序言

>   C++设计新思维/(美)Andrei Alexandrescu 著;侯捷 於春景 译
武汉：华中科技大学出版社，2003年3月
 ISBN 7-5609-2906-0

## 序言 by Scott Meyers

以下是他们的设计示例。这段代码对两个物理量作乘法运算，而这两个物理量具有任意维数的型别：

``` c++
template<int m1, int l1, int t1, int m2, Int l2, int t2>

Physical<m1+m2,l1+l2,t1+t2> operator*(Physical<m1, l1, t1> lhs,
                                      Physical<m2, l2, t2> rhs)
{
    return Physical<m1+m2,l1+l2,t1+t2>::unit*lhs.value()*rhs.value();
}
```

> 即使我没有说明这段代码，但有一点很清楚：这个 function template 有6个参数，可没有一个是型别！ template 的这种用法对我来说是头一次见到，我确实有点目眩。

### STL

不久之后，我开始阅读 STL 。在 Alexander Stepanov 精巧的程序库设计中，容器（ containers )对算法（algorithms）一无所知，算法亦对容器一无所知；迭代器（iterator）的行为像指针（但却有可能是对象）；容器和算法像接受函数指针一样地接受函数对象（function object）；用户可以扩充程序库，但不必继承其中任何 base class，也不必重新定义任何 virtual function。

### policy classes

Andrei 的目标是：为用户提供所有可能的设计选择，但不强制任何东西。

> Andrei 的方案是：将这种选择以 policy classes 的形式封装起来，允许客户将 policy classes 当做 template 参数传递，同时为这种 classes 提供合理的缺省值，使大多数客户可以忽略这些参数。

## 序言 by John Vlissides

代码自动生成 理论上的好处 **快速、易开发、冗余降低、错误更少**

> 多年来，代码生成器（code generators）一直有类似承诺，但我自己的研究以及实践经验使我相信，最终，代码生成器无法匹敌。你会有`往返旅程（round-trip）`问题，`缺乏值得生成的代码`问题，`生成器不灵活`问题，`生出莫名其妙的代码`问题，当然还有`无法将自己的代码和该死的生成出来的代码整合在一起`的问题，这些问题中的任何一个都有可能成为绊脚石；而且，对大多数编程挑战而言，这些绊脚石都使得代码自动生成不可能成为一种解决方案

### 代码生成器的问题

- 往返旅程（round-trip）

- 缺乏值得生成的代码

- 生成器不灵活

- 生出莫名其妙的代码

- 无法将自己的代码和该死的生成出来的代码整合在一起

# 前言

设计意图往往被无尽的细节吞噬

> 传统上，代码是软件系统中最琐碎、最复杂的环节，尽管历史上出现了各种层次的编程语言，支持各种设计方法（譬如面向对象方法）,但在蓝图和代码之间，总是横亘看一条鸿沟，这是因为，**代码必须仔细关照具体实现和某些辅助性任务中极其细节的问题**。

这里结合了三个要素：设计模式（design pattens）、泛型编程（generic programming）、C++

- 设计模式（design pattens）

> 本书极大地归功于设计模式（design pattens）——面临面向对象程序开发中的常见问题吋，它是强有力的解决方案。设计模式是经过提炼的出色设计方法，对于很多情况下碰到的问题，它都是合理而可复用的解决方案。设计模式致力于提供深具启发、易于表达和传递的设计词汇。

- 泛型编程（generic programming）

> 泛型编程是―种典范（paradigm），专注于将型别（type）抽象化，形成功能需求方面的―个精细集合，并利用这些需求来实现算法。由于算法为其所操作的型别定义了严格、精细的接口，因此，相同的算法可以运用于广泛的型别集（a wide collection of types）。

- C++

> C++具有实现这一切所需要的广度，其底层的C内存模型保证了最原始效率（ raw performance ），对多态（polymorphism）的支持成就了面向对象技术，templates 则展现为一种令人难以置信的代码生成器。Templates遍及本书所有代码，因为它们可以令用户和程序库之间保持最密切的协作。在遵循程序库约束的基础上，程序库的用户可以完全控制代码的生成方式。泛型组件库的角色在于，它可以让用户指定的型别和行为，与泛型组件结合起来，形成合理的设计。由于所采技术之静态特性，在结合和匹配相应组件时，产生的错误通常在编译期便得以发现。

### Loki

本书讲述―个实际的C++程序库，称为Loki。

> Loki是挪威神话中的智慧之神,同时也是一个淘气鬼；作者希望，这个程序库的创意和灵活会让你想起那个有趣的挪威神话人物。程序库中的所有元素都位于名字空间（namespace）Loki之内。

